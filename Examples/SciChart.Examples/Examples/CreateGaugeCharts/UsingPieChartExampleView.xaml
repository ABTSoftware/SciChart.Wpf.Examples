<UserControl x:Class="SciChart.Examples.Examples.CreateGaugeCharts.UsingPieChartExampleView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:ext="http://schemas.abtsoftware.co.uk/scichart/exampleExternals"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:s="http://schemas.abtsoftware.co.uk/scichart"
             xmlns:gauge="clr-namespace:SciChart.Examples.Examples.CreateGaugeCharts"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             d:DesignHeight="400"
             d:DesignWidth="600"
             mc:Ignorable="d">

    <UserControl.Resources>
        
        <gauge:LegendPlacementToOrientationConverter x:Key="LegendPlacementToOrientationConverter"/>

        <Style x:Key="PieChartListBoxForegroundStyle" TargetType="ListBox">
            <Setter Property="MinWidth" Value="160"/>
            <Setter Property="Margin" Value="30"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#FFDFE0E6" />
            <Setter Property="ItemsPanel">
                <Setter.Value>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="{Binding LegendPlacement, Source={x:Reference pieSurface}, Converter={StaticResource LegendPlacementToOrientationConverter}}"/>
                    </ItemsPanelTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <DataTemplate x:Key="OutsideLabelDataTemplate" DataType="s:IPieSegmentViewModel">
            <StackPanel Orientation="Horizontal">
                <TextBlock FontSize="14" Foreground="#FFDFE0E6" Text="{Binding Name}" />
                <TextBlock Margin="5 0 0 0" FontSize="14" Foreground="#FFDFE0E6"
                           Text="{Binding Percentage, StringFormat={}{0:#.##}%}" />
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="InsideLabelDataTemplate" DataType="s:IPieSegmentViewModel">
            <TextBlock FontSize="14" FontWeight="Bold" Foreground="{StaticResource ThemedChartBackground}"
                       Text="{Binding Percentage, StringFormat={}{0:#.##}%}" />
        </DataTemplate>

    </UserControl.Resources>

    <Grid>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <ext:SciChartInteractionToolbar Grid.Column="0">
            <ToggleButton IsChecked="{Binding Source={x:Reference Name=pieSurface}, Path=ShowTooltip, Mode=TwoWay}"
                          Style="{StaticResource DefaultToggleButtonStyle}"
                          ToolTipService.ToolTip="Tooltip">
                <ext:ToolbarIcon Kind="TooltipTextOutline" Style="{StaticResource ToolbarButtonIconStyle}"/>
            </ToggleButton>

            <ext:FlyoutMenuButton ToolTipService.ToolTip="Legend placement">
                <ext:ToolbarIcon Kind="ViewSplitVertical" Height="14" Width="14" Style="{StaticResource ToolbarButtonIconStyle}"/>
                <ext:FlyoutMenuButton.PopupContent>
                    <StackPanel Margin="5" Width="150" Orientation="Vertical">
                        <TextBlock Text="Legend placement" Style="{StaticResource FlyoutMenuHeaderStyle}"/>
                        <ComboBox ItemsSource="{Binding Source={ext:EnumValues {x:Type s:LegendPlacement}}}" SelectedItem="{Binding Source={x:Reference pieSurface}, Path=LegendPlacement, Mode=TwoWay, Converter={StaticResource SelectedEnumValueConverter}}"/>
                        <CheckBox Margin="0,10,0,5" Content="Show legend" IsChecked="{Binding ShowLegend, Mode=TwoWay, Source={x:Reference pieSurface}}"/>
                    </StackPanel>
                </ext:FlyoutMenuButton.PopupContent>
            </ext:FlyoutMenuButton>

            <ToggleButton IsChecked="{Binding Source={x:Reference Name=pieSurface}, Path=AllowMultiSelect, Mode=TwoWay}"
                          Style="{StaticResource DefaultToggleButtonStyle}"
                          ToolTipService.ToolTip="Allow multi select">
                <ext:ToolbarIcon Kind="ChartDonut" Style="{StaticResource ToolbarButtonIconStyle}"/>
            </ToggleButton>

            <ext:FlyoutMenuButton ToolTipService.ToolTip="Add new item">
                <ext:ToolbarIcon Kind="Plus" Height="14" Width="14" Style="{StaticResource ToolbarButtonIconStyle}"/>
                <ext:FlyoutMenuButton.PopupContent>
                    <StackPanel Margin="5" Width="150" Orientation="Vertical">
                        <TextBlock Text="Text" Style="{StaticResource FlyoutMenuHeaderStyle}"/>
                        <TextBox x:Name="NewTextTBox" Text="{Binding NewSegmentText, Mode=TwoWay}"/>

                        <TextBlock Text="Value" Margin="0,10,0,5" Style="{StaticResource FlyoutMenuHeaderStyle}"/>
                        <TextBox x:Name="NewValueTBox"
                                 PreviewTextInput="UIElement_OnPreviewTextInput"
                                 Text="{Binding NewSegmentValue, Mode=TwoWay}"/>

                        <TextBlock Text="Fill" Margin="0,10,0,5" Style="{StaticResource FlyoutMenuHeaderStyle}"/>
                        <ComboBox x:Name="BrushesComboBox"
                                  ItemsSource="{Binding AllBrushes}"
                                  SelectedItem="{Binding NewSegmentBrush, Mode=TwoWay}">

                            <ComboBox.ItemTemplate>
                                <DataTemplate DataType="{x:Type gauge:BrushViewModel}">
                                    <StackPanel Orientation="Horizontal" Background="Transparent">
                                        <Rectangle Width="12" Height="12" Fill="{Binding Brush}"/>
                                        <TextBlock Margin="5,0" Text="{Binding BrushName}" FontWeight="Regular" Style="{StaticResource FlyoutMenuHeaderStyle}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>

                        <Button Content="Add" Margin="0,10,0,0" Command="{Binding AddNewItemCommand}"/>

                    </StackPanel>
                </ext:FlyoutMenuButton.PopupContent>
            </ext:FlyoutMenuButton>

            <ext:FlyoutMenuButton ToolTipService.ToolTip="Edit selected segment" IsEnabled="{Binding IsSelected, Mode=OneWay}">
                <ext:ToolbarIcon Kind="Pencil" Height="14" Width="14" Style="{StaticResource ToolbarButtonIconStyle}"/>
                <ext:FlyoutMenuButton.PopupContent>
                    <StackPanel Margin="5" Width="150" Orientation="Vertical">
                        <TextBlock Text="Text" Style="{StaticResource FlyoutMenuHeaderStyle}"/>
                        <TextBox Text="{Binding SelectedSegment.Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                        <TextBlock Text="Value" Margin="0,10,0,5" Style="{StaticResource FlyoutMenuHeaderStyle}"/>
                        <TextBox PreviewTextInput="UIElement_OnPreviewTextInput"
                                 Text="{Binding SelectedSegment.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                </ext:FlyoutMenuButton.PopupContent>
            </ext:FlyoutMenuButton>
        </ext:SciChartInteractionToolbar>

        <!-- Pie Chart declaration -->
        <s:SciChartPieSurface x:Name="pieSurface"
                              Grid.Column="1"
                              Background="{StaticResource ThemedChartBackground}"
                              ChartTitle="Recommended Diet"
                              FontSize="20"
                              Foreground="White"
                              SegmentSpacing="4"
                              InsideLabelTemplate="{StaticResource InsideLabelDataTemplate}"
                              LegendListStyle="{StaticResource PieChartListBoxForegroundStyle}"
                              OutsideLabelTemplate="{StaticResource OutsideLabelDataTemplate}"
                              ItemsSource="{Binding PieSegmentViewModels}">

            <i:Interaction.Behaviors>
                <!-- Note: To use this in your own application, grab from github at https://github.com/ABTSoftware/SciChart.WPF.Examples/tree/master/v5.x/Examples/SciChart.Examples.ExternalDependencies/Behaviors -->
                <ext:EventToCommandBehavior Command="{Binding SegmentSelectionCommand}" Event="SelectionChanged" PassArguments="True" />
            </i:Interaction.Behaviors>

            <s:SciChartPieSurface.ItemTemplate>
                <DataTemplate DataType="gauge:PieSegmentViewModel">
                    <s:PieSegment Fill="{Binding Fill, Mode=TwoWay}" SegmentValue="{Binding Path=Value, Mode=TwoWay}" Text="{Binding Path=Name, Mode=TwoWay}" IsSelected="{Binding IsSelected, Mode=TwoWay}" />
                </DataTemplate>
            </s:SciChartPieSurface.ItemTemplate>

            <!-- Brushes are per segment. If you do not specify brushes, SciChart will choose random brushes -->
            <!-- you can specify SolidColorBrush, or GradientBrushes to give your Pie Chart a slightly less flat appearance -->
            <s:SciChartPieSurface.BrushesCollection>

                <LinearGradientBrush>
                    <GradientStop Color="#FFA8AABA" Offset="0"/>
                    <GradientStop Color="#FF8398BA" Offset="1"/>
                </LinearGradientBrush>

                <LinearGradientBrush>
                    <GradientStop Color="#FFA8D2F6" Offset="0"/>
                    <GradientStop Color="#FF84D2F6" Offset="1"/>
                </LinearGradientBrush>

                <LinearGradientBrush>
                    <GradientStop Color="#FF444b92 " Offset="0"/>
                    <GradientStop Color="#FF274b92 " Offset="1"/>
                </LinearGradientBrush>

                <LinearGradientBrush>
                    <GradientStop Color="#FFA881ED" Offset="0"/>
                    <GradientStop Color="#FF4781ED" Offset="1"/>
                </LinearGradientBrush>

                <LinearGradientBrush>
                    <GradientStop Color="#FFA869AE" Offset="0"/>
                    <GradientStop Color="#FFE269AE" Offset="1"/>
                </LinearGradientBrush>

                <LinearGradientBrush>
                    <GradientStop Color="#FFD2C667" Offset="0"/>
                    <GradientStop Color="#FFE8C667" Offset="1"/>
                </LinearGradientBrush>

            </s:SciChartPieSurface.BrushesCollection>

            <s:SciChartPieSurface.InfoLinesStyle>
                <Style TargetType="Line">
                    <Setter Property="Stroke" Value="#FFDFE0E6" />
                </Style>
            </s:SciChartPieSurface.InfoLinesStyle>

            <s:SciChartPieSurface.SegmentTooltipTemplate>
                <DataTemplate DataType="s:IPieSegmentViewModel">
                    <Grid Margin="3" HorizontalAlignment="Stretch">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>

                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Grid.Column="0"
                                   Margin="3"
                                   VerticalAlignment="Center"
                                   FontSize="14"
                                   Text="Name: " />

                        <TextBlock Grid.Row="0"
                                   Grid.Column="1"
                                   Margin="3"
                                   VerticalAlignment="Center"
                                   FontSize="14"
                                   Text="{Binding Name}" />

                        <TextBlock Grid.Row="1"
                                   Grid.Column="0"
                                   Margin="3"
                                   VerticalAlignment="Center"
                                   FontSize="14"
                                   Text="Value: " />

                        <TextBlock Grid.Row="1"
                                   Grid.Column="1"
                                   Margin="3"
                                   VerticalAlignment="Center"
                                   FontSize="14"
                                   Text="{Binding Value}" />
                    </Grid>
                </DataTemplate>
            </s:SciChartPieSurface.SegmentTooltipTemplate>
        </s:SciChartPieSurface>
    </Grid>
</UserControl>
